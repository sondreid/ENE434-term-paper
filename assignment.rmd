---
title: "Term paper ENE434: Texas Energy Crisis"
output: pdf_document
---
  
The Texas Energy crisis was a series of rolling power blackouts that resulted in billions of dollars worth of loss, and estimated 151 lives lost.
A record cold wave hit the majority of mainland United States resulting in sustained temperatures well below 0 degrees celsius.
The contrast between the record temperatures induced by the coldwave and normal winter temperatures was particularly stark in the south of the United States.
The majority of homes and businesses in Texas rely on heating by resistive heating or reversed-refrigeration. In particular, over 60 % of
homes rely entirely on electrical power for heating. 
As many of the power generating facilities lacks winterization, all types of energy generation sources saw a reduction in a net generation. 
The combination of substantially increased demand and reduction in power generation lead to the decision of ERCOT to reduce load on the electrical grid. 
This was an unevitable outcome, as the ever strained power generation and increasing power demand will lead to a decrease in frequency unless load is shed. 
Such a frequency drop may damage equipment, and cause instability across the grid. In the United States power generation is synchronized to operate at 60 hz, with adverse affects occurring already at 0.6 hz decrease in frequency. 
The two largest energy sources, natural gas and wind power, went through the largest reductions in net output of all sources. 

```{r, echo = FALSE, include=FALSE}

library(EIAdata)
library(fpp3)
library(tidyverse)
library(magrittr)
library(lubridate)
library(x13binary)
library(kableExtra)
library(seasonal)
`%notin%` <- Negate(`%in%`) #Adds  a custom inverse %in% function
load(file = "Data/texas_data.Rdata")
color_scheme <- c("black", "#EDA63A", "#5093F8",
                  "#34eb89", "#9d45f5",  "#f5455c") # General color scheme for plots 


texas_temperature <- read.csv("Data/texas_temperature.csv") %>%
  dplyr::select(NAME:TMIN) %>% 
  rename(station = NAME,
         date = DATE,
         temp_avg = TAVG,
         temp_min = TMIN,
         temp_max = TMAX) %>% 
  mutate(date = lubridate::ymd(date)) %>% 
  dplyr::select(date, station, temp_avg, temp_min, temp_max)

# Compose new dataframe where three station data is averaged
texas_temperature_avg <- texas_temperature %>% group_by(date) %>% 
  filter(!is.na(temp_avg)) %>% 
  summarise(temp_avg = mean(temp_avg),
            temp_min = mean(temp_min), 
            temp_max = mean(temp_max)) 

options(knitr.kable.NA = '')


```



Unfortunately, the power generation data collected for this analysis only goes back to 2018 of july and as a result the table

```{r, echo = TRUE, include=TRUE}
# Minimum, 25%-percentile, Mean, Median, 75%-percentile and Maximum by month

# Create table data

table_power_input_data <- demand_data_daily %>% filter(date > "2018-07-01") %>% 
  left_join(generation_daily %>% filter(type == "total"), by = c("date")) %>% 
  filter(!is.na(mWh_generated))


tibble(Type = "Power demand", 
       Minimum = min(table_power_input_data$mWh_demand_daily), 
       Max = max(table_power_input_data$mWh_demand_daily),
       "Maximum date" = table_power_input_data[which.max(table_power_input_data$mWh_demand_daily),]$date,
       "Minimum date" = table_power_input_data[which.min(table_power_input_data$mWh_demand_daily),]$date,
       "25% - percentile" = quantile(table_power_input_data$mWh_demand_daily, 0.25),
       "75% - percentile" = quantile(table_power_input_data$mWh_demand_daily, 0.75)) %>% 
  bind_rows(
    tibble(Type = "Power generation", 
       Minimum = min(table_power_input_data$mWh_generated), 
       Max = max(table_power_input_data$mWh_generated),
       "Maximum date" = table_power_input_data[which.max(table_power_input_data$mWh_generated),]$date,
       "Minimum date" = table_power_input_data[which.min(table_power_input_data$mWh_generated),]$date,
       "25% - percentile" = quantile(table_power_input_data$mWh_generated, 0.25),
       "75% - percentile" = quantile(table_power_input_data$mWh_generated, 0.75)),) %>% 
  kbl(caption = "Summary statistics of power generaton and power demand in Texas (from 2018-07)") %>%
    kable_classic(full_width = F, html_font = "Times new roman")

tibble("Maximum deviation" =max(table_power_input_data$mWh_demand_daily - table_power_input_data$mWh_generated),
       "Maximum deviation date" = table_power_input_data[which.max(max(table_power_input_data$mWh_demand_daily - 
                                                                         table_power_input_data$mWh_generated)),]$date) %>% 
    kbl(caption = "Maximum difference in power demand and total power generation") %>%
    kable_classic(full_width = F, html_font = "Times new roman")


                  
```

The temperatures are below are averages taken from three weather stations dispersed around the state of Texas. 

```{r, echo = TRUE, include=TRUE}
# Minimum, 25%-percentile, Mean, Median, 75%-percentile and Maximum by month

# Create table data

table_power_input_data <- demand_data_daily %>% filter(date > "2018-07-01") %>% 
  left_join(generation_daily %>% filter(type == "total"), by = c("date")) %>% 
  filter(!is.na(mWh_generated))




temperature_table_data <- texas_temperature %>% filter(!is.na(temp_max))
# Remove clear outliers
temperature_table_data %<>% filter(!temp_min < -40)

  
tibble("Average temperature" = mean(texas_temperature_avg$temp_avg),
       "Max average temperature" = max(texas_temperature_avg$temp_avg),
       "Max average temperature date" = texas_temperature_avg[which.max(texas_temperature_avg$temp_avg), ]$date,
       "Minimum average temperature" = min(texas_temperature_avg$temp_avg),
       "Minimum average temperature date" = texas_temperature_avg[which.min(texas_temperature_avg$temp_avg), ]$date, 
       "Absolute maximum temperature" = max(temperature_table_data$temp_max), 
       "Absolute maximum temperature date" = temperature_table_data[which.max(temperature_table_data$temp_max),]$date,
       "Absolute minimum temperature"       = min(temperature_table_data$temp_min),
       "Absolute minimum temperature date" = temperature_table_data[which.min(temperature_table_data$temp_min),]$date)   %>% 
  kbl(caption = "Summary temperature statistics") %>%
    kable_classic(full_width = F, html_font = "Times new roman")


                  
```







Power generation and demand in february
```{r, echo = TRUE, include=TRUE}
### Energy generation by source in february

demand_data_daily  %>% 
  filter(month(date) == 2 & 
           year(date) == 2021) %>% 
  ggplot() +
  geom_line(aes(x = date, y = mWh_demand_daily, col = "mWh demand")) +
  geom_line(aes(x = date, mWh_generated, col = "mWh generated" ),
            data = generation_daily %>% filter(
              month(date) == 2 &
              year(date) == 2021 &
              type == "total"
            )) +
  scale_colour_manual(values = color_scheme) +
  labs(title = "Demand vs power generation", subtitle = "in mWh",
       x = "Date", y = "mWh") +
  theme_bw()

```
We can see that net generation exceeds in particular around February 14th, where ERCOT decided to shed load to preserve grid stability. 
We will explore those days closer in the next plot.


```{r, echo = TRUE, include=TRUE}
### Closer look at load sheds days

#load_sheds <- data.frame(date = lubridate::ymd(c("2021-02-14")),
 #                        load_shed = c())

  
  
  
demand_data_daily  %>% 
  filter(date > "2021-02-07" &
         date < "2021-02-23") %>% 
  mutate(mWh_generated = (generation_daily %>% 
              filter(date > "2021-02-07" &
              date < "2021-02-23",
              type == "total"
            ))$mWh_generated) %>% 
  ggplot() +
  geom_line(aes(x = date, y = mWh_demand_daily, col = "mWh demand")) +
  geom_line(aes(x = date, mWh_generated, col = "mWh generated" )) +
  geom_ribbon(aes(x = date, ymin = mWh_demand_daily,
                  ymax = mWh_generated), fill = "grey") +
 geom_vline(xintercept = as.numeric(as.Date("2021-02-14")),
            linetype = 4, col = "#eb8034") +
  scale_colour_manual(values = color_scheme) +
  labs(title = "Demand vs power generation", subtitle = "in mWh",
       x = "Date", y = "mWh") +
  theme_bw()
  
  
  


```
By looking at the plot above we can see that the discrepenacy between power generation and demand b




```{r, echo = TRUE, include=TRUE}
### Energy generation by source in february
generation_daily  %>% 
  filter(month(date) == 2 & 
           year(date) == 2021 & 
           type %notin% c("total", "other")) %>% 
  ggplot(aes(x = date, y = mWh_generated)) + 
  geom_line(aes(col = type)) +
  scale_colour_manual(values = color_scheme) +
  labs(title = "Power generation for all major sources in Texas",
       subtitle = "in mWh",
       x = "Date", y = "mWh") +
  theme_bw() +
  scale_colour_discrete("Type of generation")








```

